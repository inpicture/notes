{
  "version": 3,
  "sources": ["../../../src/worker.js"],
  "sourceRoot": "C:\\Users\\anton\\AppData\\Local\\Programs\\Microsoft VS Code\\notes\\.wrangler\\tmp\\deploy-wjua70",
  "sourcesContent": ["\r\nexport class NotesBackend {\r\n  constructor(state, env) {\r\n    this.state = state;\r\n    this.sessions = new Set();\r\n    this.notes = [];\r\n    // Load from storage on startup\r\n    this.state.blockConcurrencyWhile(async () => {\r\n      let stored = await this.state.storage.get(\"notes\");\r\n      this.notes = stored || [];\r\n    });\r\n  }\r\n\r\n  async fetch(request) {\r\n    const pair = new WebSocketPair();\r\n    const [client, server] = Object.values(pair);\r\n    \r\n    server.accept();\r\n    this.sessions.add(server);\r\n\r\n    // Send initial state\r\n    server.send(JSON.stringify({ type: 'SYNC_ALL', notes: this.notes }));\r\n\r\n    server.addEventListener('message', async msg => {\r\n      const data = JSON.parse(msg.data);\r\n      \r\n      // Update local state\r\n      if (data.type === 'CREATE') this.notes.push(data.note);\r\n      if (data.type === 'UPDATE') this.notes = this.notes.map(n => n.id === data.id ? { ...n, ...data.updates } : n);\r\n      if (data.type === 'DELETE') this.notes = this.notes.filter(n => n.id !== data.id);\r\n\r\n      // Save to Durable Object Storage\r\n      await this.state.storage.put(\"notes\", this.notes);\r\n\r\n      // Broadcast to others\r\n      this.sessions.forEach(s => {\r\n        if (s !== server && s.readyState === 1) s.send(msg.data);\r\n      });\r\n    });\r\n\r\n    server.addEventListener('close', () => this.sessions.delete(server));\r\n    return new Response(null, { status: 101, webSocket: client });\r\n  }\r\n}\r\n\r\nexport default {\r\n  async fetch(request, env) {\r\n    if (request.headers.get(\"Upgrade\") !== \"websocket\") {\r\n      return new Response(\"Expected WebSocket\", { status: 426 });\r\n    }\r\n    // Route everyone to the same \"global\" room for this demo\r\n    const id = env.NOTES_ROOM.idFromName(\"global\");\r\n    const stub = env.NOTES_ROOM.get(id);\r\n    return stub.fetch(request);\r\n  }\r\n};\r\n"],
  "mappings": ";;;;AACO,IAAM,eAAN,MAAmB;AAAA,EAD1B,OAC0B;AAAA;AAAA;AAAA,EACxB,YAAY,OAAO,KAAK;AACtB,SAAK,QAAQ;AACb,SAAK,WAAW,oBAAI,IAAI;AACxB,SAAK,QAAQ,CAAC;AAEd,SAAK,MAAM,sBAAsB,YAAY;AAC3C,UAAI,SAAS,MAAM,KAAK,MAAM,QAAQ,IAAI,OAAO;AACjD,WAAK,QAAQ,UAAU,CAAC;AAAA,IAC1B,CAAC;AAAA,EACH;AAAA,EAEA,MAAM,MAAM,SAAS;AACnB,UAAM,OAAO,IAAI,cAAc;AAC/B,UAAM,CAAC,QAAQ,MAAM,IAAI,OAAO,OAAO,IAAI;AAE3C,WAAO,OAAO;AACd,SAAK,SAAS,IAAI,MAAM;AAGxB,WAAO,KAAK,KAAK,UAAU,EAAE,MAAM,YAAY,OAAO,KAAK,MAAM,CAAC,CAAC;AAEnE,WAAO,iBAAiB,WAAW,OAAM,QAAO;AAC9C,YAAM,OAAO,KAAK,MAAM,IAAI,IAAI;AAGhC,UAAI,KAAK,SAAS,SAAU,MAAK,MAAM,KAAK,KAAK,IAAI;AACrD,UAAI,KAAK,SAAS,SAAU,MAAK,QAAQ,KAAK,MAAM,IAAI,OAAK,EAAE,OAAO,KAAK,KAAK,EAAE,GAAG,GAAG,GAAG,KAAK,QAAQ,IAAI,CAAC;AAC7G,UAAI,KAAK,SAAS,SAAU,MAAK,QAAQ,KAAK,MAAM,OAAO,OAAK,EAAE,OAAO,KAAK,EAAE;AAGhF,YAAM,KAAK,MAAM,QAAQ,IAAI,SAAS,KAAK,KAAK;AAGhD,WAAK,SAAS,QAAQ,OAAK;AACzB,YAAI,MAAM,UAAU,EAAE,eAAe,EAAG,GAAE,KAAK,IAAI,IAAI;AAAA,MACzD,CAAC;AAAA,IACH,CAAC;AAED,WAAO,iBAAiB,SAAS,MAAM,KAAK,SAAS,OAAO,MAAM,CAAC;AACnE,WAAO,IAAI,SAAS,MAAM,EAAE,QAAQ,KAAK,WAAW,OAAO,CAAC;AAAA,EAC9D;AACF;AAEA,IAAO,iBAAQ;AAAA,EACb,MAAM,MAAM,SAAS,KAAK;AACxB,QAAI,QAAQ,QAAQ,IAAI,SAAS,MAAM,aAAa;AAClD,aAAO,IAAI,SAAS,sBAAsB,EAAE,QAAQ,IAAI,CAAC;AAAA,IAC3D;AAEA,UAAM,KAAK,IAAI,WAAW,WAAW,QAAQ;AAC7C,UAAM,OAAO,IAAI,WAAW,IAAI,EAAE;AAClC,WAAO,KAAK,MAAM,OAAO;AAAA,EAC3B;AACF;",
  "names": []
}
